---
title: "Edge effects and optimal field sizes in Alberta"
author:
  - name: Samuel V. J. Robinson
    email: samuel.robinson@ucalgary.ca
    affiliation: University of Calgary
    footnote: 1
  - name: Lan H. Nguyen
    email: hoanglan.nguyen@ucalgary.ca
    affiliation: University of Calgary
  - name: Paul Galpern
    email: paul.galpern@ucalgary.ca
    affiliation: University of Calgary
address:
  - code: University of Calgary
    address: 2500 University Drive NW, Calgary, AB
footnote:
  - code: 1
    text: "Corresponding Author"
date: "Spring 2021"
abstract: "`r paste(readLines('abstract.Rmd'), collapse = ' ')`"
keep_tex: true
keywords:
  - beetles;
  - spiders;
  - harvestmen;
  
bibliography: yieldRefs.bib
geometry: "left=3cm,right=3cm,top=3cm,bottom=3cm"
output: 
  bookdown::pdf_book:
    base_format: rticles::elsevier_article
    toc: false
    fig_caption: true
csl: ecology-letters.csl    
header-includes:
  \makeatletter \def\ps@pprintTitle{  \let\@oddhead\@empty  \let\@evenhead\@empty  \def\@oddfoot{\centerline{\thepage}} \let\@evenfoot\@oddfoot} \makeatother
  \usepackage{float} \floatplacement{figure}{H} 
  \newcommand{\beginsupplement}{\setcounter{table}{0} \renewcommand{\thetable}{S\arabic{table}} \setcounter{figure}{0} \renewcommand{\thefigure}{S\arabic{figure}}}
  \usepackage{setspace}
  \linenumbers
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

```

\newpage
\doublespacing

# Introduction

- Preserving SNL around fields is important for agriculture and conservation
  - Ecosystem services
  - Act as reservoirs for beneficial insects
  - Microclimate zones
  - Poorly studied in North America
  - Studies tend to be limited in scope (e.g. only certain organisms/crops) and applicability
  
- Ecosystem services can influence both the mean and variability of yield in agroecosystems
  - Typically only averages (means) are considered, but higher stability (lower variance) in yield is also valuable
  
- Field size and field boundaries are directly related to the conservation of SNL in agroecosystems
  - Size examples: wheat study from the UK
  - Boundary examples: flower strip studies, hedgerows
  - In North America, there are financial incentives to make fields large and homogeneous, especially with large agricultural equipment
  - Crop edge effects cause low yields at the margins of fields because of late emergence, poor microclimate, and competition with weeds
  - At the same time, ecosystem services should decay with distance from edge, so crops at the centre of a large field will not benefit from ecosystem services
  - This suggests that yield may be maximized at distances between the edge and centre of the field, where ecosystem services cancel out negative edge effects 
  
  <!-- - This suggests a ``goldilocks" field size, where negative edge effects are canceled out by ecosystem services -->
  
- Precision yield data holds enormous promise for agronomy
  - Limited because of:
  - Lack of standardized formats
  - Yearly calibration data
  - Clear statistical protocols 
  
- In this paper we ask:
  1. How does crop yield change with distance from the edge of field?
  2. Does this depend on type of field edge? 
  3. Is there an intermediate distance where yield is maximized or variance is minimized?

# Methods

## Data collection

- Precision yield data were collected directly from farmers across Alberta
  - Farmers were solicited for yield data through local agronomists, and we received data from a total of X growers across a total of X years
  - Most fields represented only a single year of data, but we did sometimes receive multiple years of data from the same field
  - File formats vary depending on the brand of combine, so we converted data to a standard format (csv) using Ag Leader SMS
  - In total, we analyzed yield data from X field-years of data, containing a total of X million data points
  
- Yield data was collected in rectangles of the same length as the data interval (distance = speed $\times$ interval, typically 1 second) and the same width as the combine header (5-7 m)
  - We extracted the size of each polygon (m$^2$), dry yield (tonnes), and the spatial location, and the sequence of collection (1 - end of harvest)
  - Because of the large number of yield rectangles per field (30-800 thousand), we used the centroid of each polygon as its location, treating areal data as point data
  - Seeding and application rates were constant across fields, so we did not consider inputs in our analysis
  - We used dry yield (tonnes of seed/hectare after accounting for crop moisture) as our measure of crop yield
  - Due to the high number of samples at each field, we sub-sampled to 50,000 data points per field to reduce computation time

- Field boundaries were automatically digitized using buffers from the yield data locations, then manually checked using satellite imagery from Google Earth and classified land cover data from AAFC 
  - Crop boundaries are flexible, and often change yearly depending on planting and emergence conditions (e.g. flooding during some years)
  - Additionally, seminatural features often change yearly
    - Ephemeral wetlands are flooded during some years, but consist mainly of grasses during dry years
    - Grass boundaries can change if fields are used for as haying or pasture during crop rotation
  - This makes accurate and consistent classification of field boundaries difficult
  - We defined the following general categories for field boundaries:
    1. Standard: grassy field edge, staging yard, or road right-of-way (grassy strip typically 5-10m wide) 
    2. Wetland: permanent wetland; borders are largely unchanged from year-to-year
    3. Shelterbelt: permanent windbreaks, shelterbelts, remnant forests, or shrublands
    4. Other crop: annual crop or pasture with little or no visible boundary between planted areas
    5. Bare: unplanted, fallow, flooded area, temporary wetland (only present for a single season), staging yard, oil and gas equipment, or road without a planted boundary
    6. Grassland: permanent seminatural grassland or pasture (not in rotation)
  
    <!-- STANDARD -->
    <!-- WETLAND -->
    <!-- SHELTERBELT -->
    <!-- OTHERCROP -->
    <!-- BARE -->
    <!-- GRASSLAND -->
    
## Analysis

- At each field, we fit an additive model of the effect of boundary distance on crop yield while accounting for within-field spatial variation and temporal variation in the combine yield monitor
  - Ground speed is known to be extremely important to yield monitor accuracy [@arslan2002], with low ground speed registering higher yields 
  - Crop yield can vary within a field due to soil conditions, moisture, seeding rates, herbicide application, and previous agricultural practices 
    <!-- - such as strip farming -->
  - While sensor calibration can reduce combine-level bias (such as a combine recording consistently higher/lower yields across fields), this does not address sensor drift that occurs over time  within fields
  - This may be caused by sensors accumulating debris during harvest (pers. comm. Trent Clark), leading to changes in accuracy and bias over time
  
  - To model this, we fit the following model:
  
  \begin{equation}
  sqrt(yield) ~ Normal (\mu, \sigma)
  \mu = Intercept + log(Polygon Size) + f(Distance from Edge_i, b=12)_i + f(Easting, Northing, b=60) + f(Harvest Sequence, b=60)
  log(\sigma) = Intercept + log(Polygon Size) + f(Distance from Edge, b=12) + f(Easting, Northing, b=60) + f(Harvest Sequence, b=60)
  \end{equation}
  
  - where:
  1. Polygon Size = distance traveled x width of header bar ($m^2$)
  2. Distance from Edge = distance from field edge type _i_ (m)
  3. Easting, Northing = distance from centroid of field (m)
  4. Harvest Sequence = order of harvest within field (1--N points)
  5. f(x,b) = penalized thin-plate regression spline, where x is the predictor and b is the number of basis dimensions
  
- This model accounts for a) combine speed differences, b) edge effects, c) within-field spatial variation not related to edges, and d) temporal differences in harvest 
  - Spatial or temporal variation is typically modelled using a Gaussian Process Model (e.g. Kriging), but this was computationally infeasible with 50,000 data points per field
  - Penalized regression splines offer a compromise, as they account for nonlinear ``wiggly" relationships in the same way as Gaussian processes but with substantially reduced computation time
  - The number of basis dimensions was checked with the _gam.check_ function from _mgcv_
  - A smoother was not used for polygon size because the relationship was easily approximated with a log-linear relationship using a single slope term
  - All models were fit in _R_ using the _mgcv_ library, and figures were created with _ggplot2_ and _ggpubr_
  
- Most models still had a large amount of spatio-temporal autocorrelation in residuals
  - We basically just ignored this

- To combine results from all field-level models while also accounting for field-level uncertainty, we used an approach similar to bootstrapping of hierarchical mixed effects models
  - The approach was as follows
  1. Extract posterior samples of smoother parameters from each field-level model
  2. Fit meta-model of all smoothers, and save parameters
  3. Repeat 1000 times, and calculate credible intervals (10-90th percentiles of draws)
  
- We compared this 
  
  
# Results

Results here

# Discussion

Discussion here

# Authors' contributions

Author's contribution

# Acknowledgements

Funding for this research was provided by Ducks Unlimited Canada's Institute for Wetland and Waterfowl Research, the Alberta Canola Producers Commission, Manitoba Canola Growers Association, SaskCanola, the Alberta Biodiversity Monitoring Institute, and the Alberta Conservation Association.

# References {-}

<div id="refs"></div>

```{r child = 'supplemental.Rmd'}
```

