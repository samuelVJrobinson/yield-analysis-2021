---
title: "Living on the edge: crop boundary effects on precision crop yields in Alberta, Canada"
author:
  - name: Samuel V. J. Robinson
    email: samuel.robinson@ucalgary.ca
    affiliation: University of Calgary
    footnote: 1
  - name: Lan H. Nguyen
    email: hoanglan.nguyen@ucalgary.ca
    affiliation: University of Calgary
  - name: Paul Galpern
    email: paul.galpern@ucalgary.ca
    affiliation: University of Calgary
address:
  - code: University of Calgary
    address: 2500 University Drive NW, Calgary, AB
footnote:
  - code: 1
    text: "Corresponding Author"
date: "Fall 2021"
abstract: "`r paste(readLines('abstract.Rmd'), collapse = ' ')`"
keep_tex: true
keywords:
  - precision yield;
  - spillover;
  - landscape;
  
bibliography: yieldRefs.bib
geometry: "left=3cm,right=3cm,top=3cm,bottom=3cm"
output: 
  bookdown::pdf_book:
    base_format: rticles::elsevier_article
    toc: false
    fig_caption: true
csl: ecology-letters.csl    
header-includes:
  \makeatletter \def\ps@pprintTitle{  \let\@oddhead\@empty  \let\@evenhead\@empty  \def\@oddfoot{\centerline{\thepage}} \let\@evenfoot\@oddfoot} \makeatother
  \usepackage{float} \floatplacement{figure}{H} 
  \newcommand{\beginsupplement}{\setcounter{table}{0} \renewcommand{\thetable}{S\arabic{table}} \setcounter{figure}{0} \renewcommand{\thefigure}{S\arabic{figure}}}
  \usepackage{setspace}
  \linenumbers
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(knitr)
library(kableExtra)
theme_set(theme_bw())

source('../helperFunctions.R')

datSource <- read.csv('../Data/datSource.csv') %>% #Get data source
    mutate(modelComplete2=file.exists(paste0('.',modelPath2)))  #Has model2 already been run?

useThese <- with(datSource,use&grepl('Wheat|Canola|Peas',crop)&modelComplete2) #Rows to use

datSourceFinal <- datSource %>% filter(useThese)
yearsPerField <- datSourceFinal %>% count(field) %>% pull(n) #How many years of data at each unique location?

#Boundary lengths
bLengths <- read.csv('../Data/boundaryLengths.csv') %>% filter(useThese)
bNames <- c('Bare','Grassland','Other Crop','Shelterbelt','Standard','Wetland')

bLengthSummary <- bLengths %>% select(filename,contains('prop_')) %>% pivot_longer(contains('prop_')) %>%
  mutate(name=gsub('prop_','',name)) %>% na.omit() %>%
  group_by(name) %>% summarize(mean=mean(value),sd=sd(value),Nfields=sum(value>0)) %>%
  mutate(name=bNames)

#Model smoother summaries
use <- with(datSource,use&modelComplete2&crop=='Canola')
paths <- paste0('.',gsub('modList.Rdata','results.txt',datSource$modelPath2))

canolaMods <- lapply(paths[use],function(x) getModelInfo(x)$smooths) %>% 
  set_names(nm=datSource$filename[use]) %>% 
  bind_rows(.id='field') %>% 
  mutate(pval=as.numeric(pval)) 
# %>% 
#   group_by(Smoother) %>% 
#   summarize(meanP=mean(pval),maxP=max(pval),propSig=sum(pval<0.05)/n(),meanEDF=mean(edf),meanRef=mean(Ref.df))

use <- with(datSource,use&modelComplete2&crop=='Wheat')
wheatMods <- lapply(paths[use],function(x) getModelInfo(x)$smooths) %>% 
  set_names(nm=datSource$filename[use]) %>% 
  bind_rows(.id='field') %>% 
  mutate(pval=as.numeric(pval)) %>% 
  group_by(Smoother) %>% 
  summarize(meanP=mean(pval),maxP=max(pval),propSig=sum(pval<0.05)/n(),meanEDF=mean(edf),meanRef=mean(Ref.df))

use <- with(datSource,use&modelComplete2&crop=='Peas')
peaMods <- lapply(paths[use],function(x) getModelInfo(x)$smooths) %>% 
  set_names(nm=datSource$filename[use]) %>% 
  bind_rows(.id='field') %>% 
  mutate(pval=as.numeric(pval)) %>% 
  group_by(Smoother) %>% 
  summarize(meanP=mean(pval),maxP=max(pval),propSig=sum(pval<0.05)/n(),meanEDF=mean(edf),meanRef=mean(Ref.df))


# rm(use,paths)

# #Average model parameters (mean/sd slopes with pArea)
# lapply(paths[use],function(x) getModelInfo(x)$params) %>% 
#   set_names(nm=datSource$filename[use]) %>% 
#   bind_rows(.id='field') %>% group_by(Parameter) %>% 
#   summarize(meanEst=mean(Estimate),Z=mean(Estimate/SE))


```

<!-- Potential journals: Agriculture Ecosystems and Environment, Basic and Applied Ecology, Ecological Economics, Journal of Applied Ecology (probably won't like it) -->

<!-- Potential reviewers: Teja Tscharntke, Ignasi Bartomeus, Ben Woodcock, John Redhead, some Canadian/Albertan reviewers who know the crop systems? -->

<!-- Writing notes: -->
<!-- - SNL vs shelterbelt/field boundaries: they're related, but not the same thing -->
<!-- - incorporate precision yield in title -->
<!-- - “are we looking at the right thing?” -->
<!-- - remove y axis from hypothesis figure – make it completely theoretical -->
<!-- - setup: SNL is generally good for “good bugs”, but connection to spillover, and therefore ecosystem service + yield, is tenuous -->
<!-- - Does scale beyond the field matter vs within the field? -->
<!-- - The variables that moderate spillover and yield need to be re-investigated -->
<!-- - Under what circumstance might we expect this? -->
<!-- - Emphasis: implications of natural areas for yield -->
<!-- - Variable curves are “consistent with  -->

<!-- Things to do on main machine: -->
<!-- - Update "Field Locations" map to only have canola, wheat, pea fields -->
<!-- - Update other figures with more "realistic" estimates - what is the average combine ground speed? -->

\newpage
\doublespacing

# Introduction

Intensive agricultural production has increased over the last 100 years, and agricultural land now makes up over a third of ice-free land on Earth [@ramankutty2018].
This has allowed increases in human population and increased global stability in production [@foley2011].
However, this is not without cost, as higher-diversity non-crops are converted to lower-diversity crops, resulting in loss of habitat and overall biodiversity of non-target organisms.
Maintaining both biodiversity and production in agroecosystems represents a goal of conservationists and agronomists, and holds the potential for win-win scenarios ["multifunctionality" _sensu_ @mitchell2014; @frei2018].
Key to this goal is the preservation of semi-natural land (SNL) in and around crops, which represents the interface between crops and non-crops within agroecosystems.

SNL in agroecosystems is important for both agricultural production and conservation [@prietoBenitez2011], and can create better biotic and abiotic conditions for crop growth [@case2019; @weninger2021; but see @lowe2021].
SNL acts as habitat for mobile organisms, and can act as a source of ecosystem services, such as pollination or pest control [@albrecht2020; @gardner2021], but this depends on both the crop system [@gray2014; @quinn2017] and landscape context [@marja2019; @boetzl2020].
SNL can also create microclimate effects that reduce extreme temperature, trap moisture, and reduce wind speed and soil erosion [@kort1988; @brandle2004; @wratten2012].
<!-- North American agroecosystems have larger fields, different crop varieties, and agronomic practices, all of which could negate or confound potential effects of SNL. -->
Field boundaries (e.g. grass and flower strips, tree or shrub shelterbelts, road right-of-ways) are SNL of particular interest, as they are extremely common and require less land than field-sized agricultural set-asides.
  
<!-- - SNL has conflicting effects on crop yield because of ecosystem service provision as well as negative edge effects -->
Semi-natural field boundaries may cause positive or negative effects on crops, depending on the spatial scale at which ecosystem services operate.
Low yields near may occur near the edge of the field because of patchy seed emergence, poor microclimate, shading from trees, or greater competition with weeds (Figure \@ref(fig:hypotheses), Scenario 2).
Alternatively, yield may be higher near field boundaries (Scenario 3) if they provide helpful ecosystem services, as these also tend to be occur close to the field edge [@duelli2003]. 
For example, crop pollination services from bees that nest in field boundaries drops rapidly with distance [@kowalchuk1995; @garibaldi2011].
Depending on the rate at which positive and negative ecosystems services decline with distance, yet another scenario is possible.
Yield may also be maximized at intermediate distances (Scenario 4), suggesting a "Goldilocks" field size where negative edge effects are canceled out by ecosystem services.
However, this scenario is rarely considered within studies of SNL or boundary effects [but see @mitchell2014; @vanVooren2017].

<!-- In North America there are financial incentives to make fields large, homogeneous, and geometrically simple [@clare2021], but  -->


```{r hypotheses, echo=FALSE, fig.cap='Potential yield patterns, depending on ecosystem service effects with distance. Scenario 1: no effect of boundary. Scenario 2: negative edge effect on yield. Scenario 3: positive ecosystem service effect on yield. Scenario 4: edge effects are shown in red, ecosystem service effect shown blue, leading to an intermediate peak in yield.', out.width='100%'}  
  include_graphics('../Figures/ExamplePlots/hypotheses.png',dpi=NA)
```


Boundary effects are difficult to observe without large amounts of crop data, which is typically expensive and time-consuming to collect.    
Because of this, studies of SNL effects on crop yield tend to suffer from limited spatial scope and small sample sizes, reducing statistical power and generality [@baker2018; but see also @redhead2020].
Meta-analyses are a common solution to this problem [e.g. @albrecht2020; @lowe2021], but precision yield data holds enormous promise because of its relatively common usage and low operating costs. 
However, its use is limited for several reasons, namely 1) a lack of standardized formats between equipment types, 2) sensor calibration required for field-level accuracy, and 3) low familiarity with spatial statistical methods.
Ecosystem services from field boundaries may influence both the mean as well as the variability of yield in agroecosystems [@redhead2020; @hunicken2021]; typically only means are considered, but lower variability in yield can also be valuable from a grower's perspective.
There are few studies of yield variability (only those with large datasets), but precision yield data opens up the possibility of modeling within-field variability, as well as average yield.

In this paper use a precision yield dataset from Alberta, Canada to ask the following questions:
  1. How does crop yield change with distance from the edge of field?
  2. Does this depend on type of field edge? 
  3. Is there an intermediate distance where yield is maximized or variance is minimized?
To our knowledge, no other study has studied the effects of field boundaries using precision yield data, making this study one of the first of its kind.

# Methods

## Data collection

Precision yield data were collected directly from farmers across Alberta.
Farmers were solicited for yield data through local agronomists, and we received `r nrow(datSource)` field-years of data from `r length(unique(datSource$grower))` growers across a total of `r length(unique(datSource$year))` years (`r min(unique(datSource$year))`-`r max(unique(datSource$year))`).
We converted raw data to a standard csv format using Ag Leader SMS®.
`r round(100*sum(grepl('(Wheat|Canola|Peas)',datSource$crop))/nrow(datSource))`% of the crop types where either wheat (_Triticum aestivum_), canola (_Brassica napus_), or peas (_Pisum sativum_), three of the most common crops in rotation in Alberta [@statscan_canola2014].
The remaining crop types had low replication, so we constrained our analysis to only field-years containing wheat (`r sum(datSourceFinal$crop=='Wheat')`), canola (`r sum(datSourceFinal$crop=='Canola')`), or peas (`r sum(datSourceFinal$crop=='Peas')`), for a total of `r nrow(datSourceFinal)` field-years of data.
Individual fields contained between `r min(yearsPerField)` and `r max(yearsPerField)` years of data (mean: `r round(mean(yearsPerField),1)`), containing a total of `r round(sum(datSourceFinal$npoints)/1e6,1)` million data points.

```{r fieldLocataions, echo=FALSE, fig.cap='Locations of fields that data were collected from', out.width='100%'}  
  include_graphics('../Figures/Field Locations.png',dpi=NA)
```
  
Yield data was collected in rectangles of the same length as the data interval (distance = combine ground speed $\times$ interval, typically 1 second) and the same width as the combine header (5-7 m, adjusted by the combine to account for overlap with adjacent swaths).
We used dry yield (tonnes of seed per hectare minus - crop moisture) as our measure of yield, using the size of each rectangle (m$^2$), dry yield (tonnes), and the spatial location.
Because of the large number of yield rectangles per field (30-800 thousand), we used the centroid of each polygon as its location, treating areal data as point data.
Seeding and application rates were constant across fields, so we did not consider inputs in our analysis.
Precision yield data can be highly variable and is prone to extreme outliers, especially when combine ground speeds are low and at the beginning of rows [@griffin2007; @whelan2013], or when the combine is accelerating or decelerating [@arslan2002].
Therefore, we used the following filtering procedure to clean the data prior to model fitting (see Appendix A for R code): 

1. Removed outliers and "inliers" using the spatial filtering procedure from [@vega2019] 
2. Removed unrealistic yield values (10.75 T/ha for wheat, 8 T/ha for canola and peas), and values of zero or less
3. Removed extremely low and high outliers (below 1st percentile, above 99th percentile) for: dry yield, steering angle differences, ground speed
4. Removed points with large changes (>20%) in ground speed
5. Removed extremely low and high changes in position, indicating that the combine had stopped or moved to another part of the field between data collection
6. Sub-sampled filtered data to 50,000 data points per field (reduce computation time)

Field boundaries were digitized using buffers from the yield data locations, then manually checked using satellite imagery from Google Earth and classified land cover data [@AAFC_data]. 
Crop boundaries are flexible, and often change yearly depending on planting and emergence conditions.
For example, ephemeral wetlands are flooded during some years, but consist mainly of grasses during dry years, and grass boundaries can change if fields are used for as haying or pasture during crop rotation.
This makes accurate and consistent classification of field boundaries difficult, but we used the following general categories for field boundaries:
    1. Standard: grassy field edge, staging yard, or road right-of-way (grassy strip typically 5-10m wide) 
    2. Wetland: permanent wetland; borders are largely unchanged from year-to-year
    3. Shelterbelt: permanent windbreaks, shelterbelts, remnant forests, or shrublands
    4. Other crop: annual crop or pasture with little or no visible boundary between planted areas
    5. Bare: unplanted, fallow, flooded area, temporary wetland (only present for a single season), staging yard, oil and gas equipment, or road without a planted boundary
    6. Grassland: permanent seminatural grassland or pasture (not in rotation)
  
<!-- STANDARD -->
<!-- WETLAND -->
<!-- SHELTERBELT -->
<!-- OTHERCROP -->
<!-- BARE -->
<!-- GRASSLAND -->

## Analysis

Yield data from each field contains both random and systematic errors that must be modeled in order to reveal underlying changes in yield.
Crop yield can vary within a field due to soil conditions, moisture, seeding rates, herbicide application, previous agricultural practices, and other factors not directly related to boundary distance. 
To account for this, we used additive models of the effect of boundary distance on crop yield while accounting for within-field spatial variation.

<!-- Ground speed is extremely important to yield monitor accuracy, with low ground speed registering higher yields. -->
<!-- Sensor calibration can reduce combine-level bias (such as a combine recording consistently higher/lower yields across fields), this does not address sensor drift that occurs over time. -->
<!-- This may be caused by sensors accumulating debris during harvest (pers. comm. Trent Clark), leading to changes in accuracy and bias over time. -->
We fit the following model to each field-year of data:
  
  \begin{equation}
  \begin{split}
  \sqrt{Yield} \sim & Normal (\mu, \sigma)\\
  \mu = & Intercept + f(\text{Boundary Distance}, b=5)_i + \\
   & f(\text{Easting}, \text{Northing}, b=60)\\
  log(\sigma) =  & Intercept + f(\text{Boundary Distance}, b=5)_i + \\
   & f(\text{Easting}, \text{Northing}, b=60)\\
  \end{split}
  \end{equation}
  
  - where:
  1. Yield = weight of crop gathered per area of harvest (T/ha)
  2. Boundary Distance = distance from field boundary type _i_ (m)
  3. Easting, Northing = distance from centre of field (m)
  4. Sequence = order of harvest within field (1--N points)
  5. f(x,b) = penalized thin-plate regression spline, where _x_ is the predictor and _b_ is the number of basis dimensions
  
In addition to modeling edge effects (our variable of interest), this model also accounts for within-field spatial variation not related to edges.
Spatiotemporal variation can also be modelled using a Gaussian Process Model (e.g. Kriging, SPDE Approximations) but this was computationally unfeasible with 50,000 data points per field.
Penalized splines offer a compromise, as they account for nonlinear relationships in the same way as Gaussian processes using a reduced number of dimensions.
We used 5 basis dimensions for the distance smoother and 60 for the spatial smoothers, as we hypothesized that boundary effects would not be as complex as within-field variation (as in Figure \@ref(fig:hypotheses)).
<!-- The number of basis dimensions was checked with the _gam.check_ function from _mgcv_. -->
All models were fit in _R_ using the _mgcv_ library [version `r packageVersion('mgcv')`, @wood2017], and figures were created with _ggplot2_ and _ggpubr_ [versions `r packageVersion('ggplot2')`, @wickham2016; and `r packageVersion('ggpubr')`, @kassambara2020].

The residuals in most of the models displayed both spatial autocorrelation in the residuals, indicating "micro-scale" variation that was not captured by the spatial smoothers [@cressie2011; @wickle2019].
This is extremely common in precision yield data, and can bias standard errors of regression terms, but because a) there were a large number of data points per field, b) standard errors were relatively small (i.e. extremely small p-values), and c) results did not change with the addition of more basis functions (120 rather than 60), we decided to leave the models as-is.
Temporal autocorrelation in residuals was also present, but we did not include temporal smoothers because spatial and temporal processes are confounded in precision yield data.
That is, combining of fields occurs in patterns (e.g. east-to-west) so it is impossible to tell whether changes in yield in certain areas of the field were caused by deviations in the yield monitor sensors over time, or whether they represent changes in growing conditions.
We considered the latter to be a more realistic assumption, so we assigned all random variation as spatial in nature. 
Customized combine driving patterns may be able to detect temporal variation, but this is beyond the scope of this research.

<!-- _Not really sure how we can get around this. In practice, this means that SEs for all coefficients are too small (i.e. we gathered 1000 points, but because they're spatially related, it's only equivalent to 100 points)._ -->

To consider results from all field-level models together, we fit models of each field-year independently and then fit overall smoothers as averages of the field-level smoothers.
This does not account for uncertainty in the field-level smoothers, so we used an approach similar to bootstrapping:
  1. Extract single posterior sample (_rnorm_ in R) of smoother parameters from each field-level model using coefficient estimates and standard errors
  2. Use posterior sample to simulate a new smoother from each field
  3. Fit model of simulated smoothers from all fields, and save this "meta-smoother"
  4. Repeat 1000 times, and calculate coverage intervals (5-95% percentiles) on saved meta-smoothers
This gives coverage intervals (CIs) for the "average" smoother while accounting for field-level variability, and is conceptually similar to a meta-analysis.
Spatial variability was not averaged between fields because within-field variability is not directly comparable between fields.

# Results

## Field-level example

The filtered data from each field contained a large amount of variation, but the non-stationary additive models were able to reveal underlying yield patterns.
To illustrate this, we show the results from a single wheat field, where we show the relative impact of boundary distance and spatial variation on both yield mean and yield SD ("patchiness").
Figure \@ref(fig:spatialSmooths)a shows the filtered data collected from a single field, demonstrating a large amount of variation even after filtering.
Yield mean tended to increase with distance from field boundaries while yield SD tended to decrease, but there were no consistent differences between boundary types (Figure \@ref(fig:distSmooths)).
Finally, the random spatial smoothers in Figure \@ref(fig:spatialSmooths)b and c show that yield mean and SD systematically vary within fields, likely due to moisture, elevation, or soil conditions.


```{r spatialSmooths, echo=FALSE, fig.cap='Raw data and spatial smoothers from a single field. Yield averages (means) and variability (log SD) were modeled separately, and both show large spatial dependence within the field.', out.width='100%'}  
  include_graphics('../Figures/ExamplePlots/spatialSmooths.png',dpi=NA)
```


```{r distSmooths, echo=FALSE, fig.cap='Distance smoothers from a single field, showing a positive saturating effect of distance on average yield (first row), while the variability smoothers show a general decrease in yield SD (second row).', out.width='100%'}  
  include_graphics('../Figures/ExamplePlots/distSmooths.png',dpi=NA)
```



## Overall results

Across all fields, standard field boundaries (grassy borders) were the most common boundary type, followed by shelterbelts and other crops (Figure \@ref(fig:boundaryTypes)).
<!-- Not sure if we should talk about this. Not very many fields from southern regions, so it's hard to compare. Perhaps mention in Discussion -->

```{r boundaryTypes, echo=FALSE, fig.cap='Percentage of field boundaries across sampled fields.', out.width='100%'}

bLengths %>% 
  mutate(croptype=datSourceFinal$crop) %>% 
  mutate(location=ifelse(grepl('(Alvin|Dean)',filename),'Southern Alberta','Central Alberta')) %>%
  group_by(location) %>% mutate(nFields=length(unique(filename))) %>% ungroup() %>% 
  mutate(location=paste0(location,' (N = ',nFields,')')) %>%
  select(filename,croptype,location,contains('prop_')) %>% 
  pivot_longer(contains('prop_')) %>% 
  mutate(name=gsub('prop_','',name),value=value*100) %>% na.omit() %>%
  mutate(name=factor(name,labels=c('Bare','Grassland','Other\nCrop','Shelterbelt','Standard','Wetland'))) %>% 
  group_by(croptype) %>% mutate(croptype=paste0(croptype,'\n(N = ',length(unique(filename)),')')) %>% 
  ggplot(aes(x=name,y=value,fill=croptype))+geom_boxplot()+
  facet_wrap(~location,ncol=1) +
  labs(y='Percentage of field boundary',fill='Crop')+
  scale_fill_manual(values=c('grey50','grey80','white'))+
  theme(axis.title.x = element_blank(),legend.position = 'bottom')

# bLengthSummary %>% #Table version
#   kable(.,format='latex',caption='Mean and SD of proportion of boundary types across all fields, along with the number of fields bordered by at least some of the boundary type.',col.names = c('Type','Mean','SD','Number of Fields'),digits = c(1,4,4,1),escape = FALSE)

```

Overall, both yield average and yield variability were extremely spatially dependent across all fields (average p-values both <0.0001), meaning that within-field variation was the primary driver of yield across canola, wheat, and pea crops (Table \@ref(tab:smoothSummary), row 6).
Distances from boundary types were also important, but a lower proportion of the fields had strong effects (rows 1-5, cols 3 + 5). 


<!-- `r with(canolaMods,formatC(mean(pval[Smoother=='s(E,N)'])))`, `r with(canolaMods,formatC(mean(pval[Smoother=='s.1(E,N)'],3)))` -->

```{r smoothSummary, echo=FALSE, out.width='100%'}

canolaMods %>% group_by(Smoother) %>% 
  summarize(N=n(),meanChi=mean(Chisq),meanP=mean(pval),propSig=sum(pval<(0.05/N))/n()) %>% 
  ungroup() %>% 
  mutate(par=ifelse(grepl('\\.',Smoother),'Variability','Mean')) %>% 
  mutate(type=case_when(
    grepl('boundaryType',Smoother) ~ gsub('s[\\.1]*\\(dist\\)\\:boundaryType','',Smoother),
    grepl('E,N',Smoother) ~ 'Spatial Smoother'
  )) %>% 
  select(-N,-Smoother) %>% relocate(type,par,meanChi,meanP,propSig) %>% 
  pivot_wider(id_cols=type,names_from=par,values_from=c(meanChi,meanP,propSig)) %>% 
  relocate(type,meanChi_Mean,meanP_Mean,propSig_Mean,meanChi_Variability,meanP_Variability,propSig_Variability) %>% 
  mutate(type=c('Bare','Grassland','Other Crop','Shelterbelt','Standard','Wetland','Spatial Smoother')) %>% 
  kable(.,format='latex',caption='Mean $\\chi^2$, p-values, and proportion of smoother p-values less than 0.05 (after Bonneferoni correction) for mean and variability smoothers across all models.',col.names = c('Smoother Type','$\\chi^2$-value','p-value','Prop. <0.05','$\\chi^2$-value','p-value','Prop. <0.05'),
        digits = c(1,1,3,3,1,3,3),escape = FALSE) %>% 
  add_header_above(c('', 'Mean Yield' = 3, 'Yield Variability' = 3))

```


Average canola yield tended to increase with distance from all crop boundaries, starting at 2.5 T/ha at the field edge and leveling off at about 3 T/ha  (Figure \@ref(fig:canolaPlot) top row).
Shelterbelt and standard boundaries were well-represented in the data, and average yield quickly increased with distance away from the field boundary, but shelterbelts had a small intermediate maximum at around 50m before a weak decrease with distance, while average yield away from Standard field boundaries plateaued at 50m and remained roughly constant with distance.
The effect of other boundary types was less consistent, but average yield tended to increase with distance away from grassland, other crop, and wetland, and was roughly the same with distance from bare boundary types.
Yield variability (Figure \@ref(fig:canolaPlot) bottom row) was essentially constant with distance for shelterbelt, standard, and other crop field boundaries, but showed some evidence of decreasing with distance from field boundary at wetlands, bare, and grassland.
Interestingly, there was an intermediate reduction in canola yield variability at about 75 m away from Wetland boundaries, indicating a potential stabilizing effect.

```{r canolaPlot, echo=FALSE, fig.cap='Field boundary effect on canola yield, accounting for the effect of spatial variation. Upper panel represents mean yield, while the lower panel represents yield variation. N refers to number of fields containing this boundary type, and \\% refers to the average percentage of field boundary accounted for by this boundary type.', out.width='100%'}  
  include_graphics('../Figures/ModelSummary3a_canola.png',dpi=NA)
```


<!-- Similar to canola, both yield average and yield variability of wheat was spatially dependent (average p-values: `r with(wheatMods,formatC(meanP[Smoother=='s(E,N)']))`, `r with(wheatMods,formatC(meanP[Smoother=='s.1(E,N)'],3))`). -->


The effect of boundary distance on average wheat yield was much more variable than the patterns seen in canola yield.
Average yield (Figure \@ref(fig:wheatPlot), top row) roughly increased with distance away from wetland, standard, and grasslands, but both shelterbelts and bare ground displayed an intermediate maximum at around 50m (similar to canola), and decreased slightly with distance from Other Crops.
Yield variability, on the other hand, tended to decrease with distance from bare, grassland, and wetland (before 100 m, at least), increased slightly with distance from shelterbelt and standard boundaries, and was roughly constant with distance from other crops (Figure \@ref(fig:wheatPlot), bottom row).

```{r wheatPlot, echo=FALSE, fig.cap='Field boundary effect on wheat yield, accounting for the effect of spatial variation. Upper panel represents mean yield, while the lower panel represents yield variation. N refers to number of fields containing this boundary type, and \\% refers to the average percentage of field boundary accounted for by this boundary type.', out.width='100%'}  
  include_graphics('../Figures/ModelSummary3a_wheat.png',dpi=NA)
```

<!-- Both average and variability of pea yields were spatially dependent (average p-values: `r with(peaMods,formatC(meanP[Smoother=='s(E,N)']))`, `r with(peaMods,formatC(meanP[Smoother=='s.1(E,N)'],3))`). -->

Pea crops were less well-represented in our data (N = `r sum(with(datSource,use&modelComplete2&crop=='Peas'))` fields, compared to ), and therefore the effects of boundaries tended to be less consistent. 
Average pea yields (Figure \@ref(fig:peaPlot), top row) were roughly 4.25 T/ha at the field boundary and increased to just below 5 T/ha away from shelterbelt, standard, and other crop boundaries, while the effect of bare, grassland, and wetland boundaries was inconsistent.
Conversely, yield variability (Figure \@ref(fig:peaPlot), bottom row) decreased with distance from grassland, shelterbelt, standard, and wetland boundaries, while the pattern with distance from other crop and bare was inconsistent. 
Unlike canola and wheat crops, there was no obvious evidence of an intermediate increase in yield with distance from the field boundary.


```{r peaPlot, echo=FALSE, fig.cap='Field boundary effect on pea yield, accounting for the effect of spatial variation. Upper panel represents mean yield, while the lower panel represents yield variation. N refers to number of fields containing this boundary type, and \\% refers to the average percentage of field boundary accounted for by this boundary type.', out.width='100%'}  
  include_graphics('../Figures/ModelSummary3a_peas.png',dpi=NA)
```


# Discussion

Within individual fields, both the average and variability of yield changed with distance from the field boundary, and there were strong spatial relationships within each field, likely related to underlying soil or moisture conditions.
Mean yield tended to increase with distance from field boundaries before plateauing, and there was some evidence of intermediate boosts in yield from shelterbelts next to canola and wheat, while peas showed no evidence of this.
However, this intermediate increase was small in canola crops, meaning that ecosystem services likely did not vary strongly with distance from field boundaries (Scenario 2, Figure \@ref(fig:hypotheses)).
There was a fairly large (0.75 T/ha) intermediate increase in average wheat yields away from shelterbelts, indicating a potential reduction in ecosystem services with distance.
However, there was a similar (albeit weaker) pattern associated with bare ground, so this pattern may be caused by something other than the presence of shelterbelts.
This indicates that shelterbelts may have a positive effect on wheat yields, and future work should expand this across a larger geographic domain in order to inform growers about how best to manage the landscapes surrounding their fields.


<!-- Need a paragraph on wheat + shelterbelt effect -->



<!-- For example, average canola yield was about 0.5 T/ha lower close to Standard field edges, and yield SD was about 0.3 T/ha SD higher. -->
Why did we find few consistent effects of boundary type on crop yield, aside from shelterbelts?
Our work examined only the first and last links in the causal chain _Field boundary_ $\rightarrow$ _Insect Abundance_ $\rightarrow$ _Crop Yield_, meaning that are two mediating relationships where the overall relationship could be broken or obscured.
First, field boundaries may not have any influence on insect abundance if separated from the larger landscape context, or spillover of beneficial organisms may be low.
Second, beneficial insect abundance may not influence crop yield if pest pressure or pollination deficits are low, which may vary yearly, or by location.
<!-- However, our work does show that precision yield data could easily be joined to data on insect abundance to model this more completely. -->
Our work suggests that we need to better examine the context in which a) beneficial organisms spillover from field boundaries and b) when organisms in crops provide tangible ecosystem services.
We consider these reasons below:

<!-- ## Boundaries may not provide spillover -->

SNL generally has a positive effect on spillover, but field boundaries only represent a fraction of the SNL that surrounds a given field.
Our analysis only examined boundary types, without considering the landscape context that fields were embedded in, but some studies show the influence of landscape composition at larger spatial scales [@nguyen2021] which could be particularly important when beneficial arthropods are disperse very broadly [@oberg2007].
There could also be interactions between landscape composition at different scales [@motzke2016; @robinson2021; @haslem2021], but this is not broadly studied.
Landscape complexity [@fahrig2011] and connectivity are also associated with higher abundance of beneficial arthropods.
This means that field boundaries such as wetlands or shelterbelts may only be helpful if connected to a larger network of non-crop habitat [but see @fahrig2019].

Field boundary traits may play an important role in mediating spillover, but our definitions of boundaries were (necessarily) loose, as we used satellite imagery to manually classify them.
Therefore, it may be that other aspects of field boundaries, such as size or plant community composition, are more important for spillover of ecosystems services into fields.
For example, larger [@lecq2018; @stasiov2020] or more functionally diverse [@bonifacio2011; @boughey2011] hedgerows tend to support more biodiversity than smaller hedgerows, and some studies have shown that leaf litter and soil compaction matters to predatory beetle communities [@sutter2018b].
These fine-scale boundary characteristics were not measured in our study, but could be used as variables in more biologically-meaningful classifications of field boundaries.

Our first scenario (Scenario 1, Figure \@ref(fig:hypotheses)) assumes that beneficial organisms disperse from boundaries into the field, and had a generally positive effect on crop yield.
However, field boundaries may not have a positive effect if a) ecosystem dis-services -- pest insects or weed seeds -- also disperse along with beneficials, or if b) beneficials do not disperse from the boundary environment.
Pests and weeds can also disperse from field boundaries, which may negate any positive effect of ecosystem services [@zhang2007].
@gray2014 showed that remnant forest fragments do not provide significant pest control services, but also do not depress yield.
However, this is still poorly studied, and parsing out services from disservices is impossible using crop yield data _alone_.
Ecosystem services from field boundaries may be limited if beneficial organisms stay in field boundaries, or disperse at wider spatial scales [@oberg2007; @zamorano2020, but see @robinson2021].

<!-- ## Beneficial organisms may not provide ecosystem services -->

Pest pressure or pollination deficit may be low enough that ecosystem service provision does not significantly change yield.
Canola is largely self-pollinating [at least in hybrid canola varieties, @lindstrom2016] and wheat is wind-pollinated, meaning that slight increases in pollination services may not change yields significantly in either crop [@woodcock2016].
Pests are also limited by growers' application of insecticides (seed-treated or on the crop directly), and insect pest outbreaks tend to be temporally and spatially spotty.

Our work is some of the first to use a large precision yield dataset to answer questions about how landscapes influence yield, but this study has only scratched the surface of some of the richest agroecological datasets ever created.
Since our sampling represents a limited amount of spatial and temporal coverage, there could be additional confounding variables that obscure signals of yield.
Most fields were located in Central Alberta [Dry Mixedwood region, @ABRegions2006], where boundaries contained a higher proportion of shelterbelts (Figure \@ref(fig:boundaryTypes)), but differences from Southern AB (Foothills Fescue and Mixedgrass region) may be confounding the signal.
Between-year effects may be important, especially during dry years [@kort1988], but this was not considered in our analysis.
Future work could examine whether boundaries have differing effects during hot or cool years, as shading or cooling effects may increase yield during hot years but have negative (or no) effect during cooler years.
  
<!-- We used harvest time as smoothed variable to deal with temporal autocorrelation in the data, but this is a crude way to deal with this. -->
<!-- This is because in-field combine driving patterns _almost always_ induce correlation between spatial and temporal measurements (e.g. northern section of the field was harvested before the southern section), meaning that temporal and spatial random effects are difficult to separate. -->
<!-- There are few solutions to this using harvest data as-is, other than to ignore temporal random effects entirely, thereby constraining all random variation to be spatial. -->
<!-- However, it is possible to remove correlation between spatial and temporal measurements by using specially designed harvest patterns within a field (harvesting alternating strips sequentially across the field, then harvesting the remaining strips on a second pass). -->
<!-- Future studies could use this to estimate drift in combine sensor measurements over time. -->
  

# Author Contributions

SVJR, LHN, and PG conceived of the project.
SVJR collected data, conducted analysis, and wrote the manuscript.

# Acknowledgements

We thank Trent Clark, Dean Hubbard, Alvin French, and Kristina Polziehn for providing yield data for us, and providing insight on their yield data. 
We also thank Autumn Barnes and Keith Gabert of the Canola Council of Canada, and Laurel Thompson and JP Pettyjohn of Lakeland College for connecting us with farmers and agronomists.
Funding for this research was provided by Ducks Unlimited Canada's Institute for Wetland and Waterfowl Research, the Alberta Canola Producers Commission, Manitoba Canola Growers Association, SaskCanola, the Alberta Biodiversity Monitoring Institute, and the Alberta Conservation Association.

# References {-}

<div id="refs"></div>

<!-- ```{r child = 'supplemental.Rmd'} -->
<!-- ``` -->

