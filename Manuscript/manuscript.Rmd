---
title: "Living on the edge: crop boundary effects on canola and wheat yields in Alberta"
author:
  - name: Samuel V. J. Robinson
    email: samuel.robinson@ucalgary.ca
    affiliation: University of Calgary
    footnote: 1
  - name: Lan H. Nguyen
    email: hoanglan.nguyen@ucalgary.ca
    affiliation: University of Calgary
  - name: Paul Galpern
    email: paul.galpern@ucalgary.ca
    affiliation: University of Calgary
address:
  - code: University of Calgary
    address: 2500 University Drive NW, Calgary, AB
footnote:
  - code: 1
    text: "Corresponding Author"
date: "Fall 2021"
abstract: "`r paste(readLines('abstract.Rmd'), collapse = ' ')`"
keep_tex: true
keywords:
  - precision yield;
  - spillover;
  - landscape;
  
bibliography: yieldRefs.bib
geometry: "left=3cm,right=3cm,top=3cm,bottom=3cm"
output: 
  bookdown::pdf_book:
    base_format: rticles::elsevier_article
    toc: false
    fig_caption: true
csl: ecology-letters.csl    
header-includes:
  \makeatletter \def\ps@pprintTitle{  \let\@oddhead\@empty  \let\@evenhead\@empty  \def\@oddfoot{\centerline{\thepage}} \let\@evenfoot\@oddfoot} \makeatother
  \usepackage{float} \floatplacement{figure}{H} 
  \newcommand{\beginsupplement}{\setcounter{table}{0} \renewcommand{\thetable}{S\arabic{table}} \setcounter{figure}{0} \renewcommand{\thefigure}{S\arabic{figure}}}
  \usepackage{setspace}
  \linenumbers
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(knitr)
library(kableExtra)
theme_set(theme_bw())

source('../helperFunctions.R')

datSource <- read.csv('../Data/datSource.csv') %>% #Get data source
    mutate(modelComplete2=file.exists(paste0('.',modelPath2)))  #Has model2 already been run?

useThese <- with(datSource,use&grepl('Wheat|Canola|Peas',crop)) #Rows to use

datSourceFinal <- datSource %>% filter(useThese)
yearsPerField <- datSourceFinal %>% count(field) %>% pull(n) #How many years of data at each unique location?

#Boundary lengths
bLengths <- read.csv('../Data/boundaryLengths.csv') %>% filter(useThese)
bNames <- c('Bare','Grassland','Other Crop','Shelterbelt','Standard','Wetland')

bLengthSummary <- bLengths %>% select(filename,contains('prop_')) %>% pivot_longer(contains('prop_')) %>%
  mutate(name=gsub('prop_','',name)) %>% na.omit() %>%
  group_by(name) %>% summarize(mean=mean(value),sd=sd(value),Nfields=sum(value>0)) %>%
  mutate(name=bNames)

#Model smoother summaries
use <- with(datSource,use&modelComplete2&crop=='Canola')
paths <- paste0('.',gsub('modList.Rdata','results.txt',datSource$modelPath2))

canolaMods <- lapply(paths[use],function(x) getModelInfo(x)$smooths) %>% 
  set_names(nm=datSource$filename[use]) %>% 
  bind_rows(.id='field') %>% 
  mutate(pval=as.numeric(pval)) %>% 
  group_by(Smoother) %>% 
  summarize(meanP=mean(pval),maxP=max(pval),propSig=sum(pval<0.05)/n(),meanEDF=mean(edf),meanRef=mean(Ref.df))

use <- with(datSource,use&modelComplete2&crop=='Wheat')
wheatMods <- lapply(paths[use],function(x) getModelInfo(x)$smooths) %>% 
  set_names(nm=datSource$filename[use]) %>% 
  bind_rows(.id='field') %>% 
  mutate(pval=as.numeric(pval)) %>% 
  group_by(Smoother) %>% 
  summarize(meanP=mean(pval),maxP=max(pval),propSig=sum(pval<0.05)/n(),meanEDF=mean(edf),meanRef=mean(Ref.df))

use <- with(datSource,use&modelComplete2&crop=='Peas')
peaMods <- lapply(paths[use],function(x) getModelInfo(x)$smooths) %>% 
  set_names(nm=datSource$filename[use]) %>% 
  bind_rows(.id='field') %>% 
  mutate(pval=as.numeric(pval)) %>% 
  group_by(Smoother) %>% 
  summarize(meanP=mean(pval),maxP=max(pval),propSig=sum(pval<0.05)/n(),meanEDF=mean(edf),meanRef=mean(Ref.df))


rm(use,paths)

# #Average model parameters (mean/sd slopes with pArea)
# lapply(paths[use],function(x) getModelInfo(x)$params) %>% 
#   set_names(nm=datSource$filename[use]) %>% 
#   bind_rows(.id='field') %>% group_by(Parameter) %>% 
#   summarize(meanEst=mean(Estimate),Z=mean(Estimate/SE))


```

Potential journals: Agriculture Ecosystems and Environment, Basic and Applied Ecology, Ecological Economics, Journal of Applied Ecology (probably won't like it)

Potential reviewers: Teja Tscharntke, Ignasi Bartomeus, Ben Woodcock, John Redhead, some Canadian/Albertan reviewers who know the crop systems?

\newpage
\doublespacing

# Introduction

Intensive agricultural production has increased over the last 100 years, and agricultural land now makes up over a third of ice-free land on Earth.
This has allowed increases in human population and increased global stability in production.
However, this is not without cost, as higher-diversity non-crops are converted to lower-diversity crops, resulting in loss of habitat and overall biodiversity of non-target organisms.
Maintaining both biodiversity and production in agroecosystems represents a seldom-considered goal of conservationists and agronomists, and hold the potential for win-win scenarios.
Key to this is the preservation of semi-natural land (SNL), which represents the interface between crops and non-crops within agroecosystems.

SNL in and around crops is important for both agricultural production and conservation [@prietoBenitez2011], as it has the potential to create better biotic and abiotic conditions for crop growth [@case2019; @weninger2021; but see @lowe2021].
They are habitat for mobile organisms, and can act as sources of ecosystem services such as pollination or pest control [@albrecht2020; @gardner2021], but this can vary depending on the system [@gray2014; @quinn2017]
They also can create microclimate effects that reduce extreme temperature, trap moisture, and reduce wind speed [@kort1988; @brandle2004].
North American agroecosystems have larger fields, different crop varieties, and agronomic practices, all of which could negate or confound potential effects of SNL
  
<!-- - SNL has conflicting effects on crop yield because of ecosystem service provision as well as negative edge effects -->
SNL may affect yields at intermediate distances, depending on the spatial scale at which ecosystem services operate.
Edge effects cause low yields at the edge of crops because of sparse or late seedling emergence, poor microclimate, and competition with weeds.
At the same time, the centre of large fields will not receive ecosystem services if they decay with distance from edges [@kowalchuk1995].
For example, pollination services from central place foragers (bees) that nest in SNL but forage in crops drops rapidly with distance [@garibaldi2011].
Therefore, yield may be maximized at intermediate distances, where the ecosystem services cancel out negative edge effects [@vanVooren2017].
This suggests a "goldilocks" field size, where negative edge effects are canceled out by ecosystem services.
<!-- In North America there are financial incentives to make fields large, homogeneous, and geometrically simple [@clare2021], but  -->


```{r hypotheses, echo=FALSE, fig.cap='Potential yield patterns, depending on ecosystem service effects with distance. In both figures, negative environmental effects (edge effects) are shown in red, and decrease with distance from the edge of the crop, creating an increase in yield with distance. The left figure shows a decline in ecosystem services with distance, leading to an intermediate peak in yield, while the right figure shows an increase in services with distance, leading to a peak at the centre of the field (note: Scenario 2 also occurs if ecosystem services do not change with distance).', out.width='100%'}  
  include_graphics('../Figures/ExamplePlots/hypotheses.png',dpi=NA)
```

    
Studies of SNL effects on crop yield also suffer from limited scope (e.g. few crop types) and small sample sizes, limiting inference and reducing generality [@baker2018; but see also @redhead2020].
Meta-analyses have been the standard solution to this problem [e.g. @albrecht2020; @lowe2021], but precision yield data holds enormous promise.
However, its use is limited for several reasons, namely: 1) Lack of standardized formats between equipment types, 2) Sensor calibration required for field-level accuracy, and 3) low familiarity with spatial statistics.
Ecosystem services can influence both the mean and variability of yield in agroecosystems [@redhead2020]; typically only averages (means) are considered, but higher stability (lower variance) in yield can also be valuable from a grower's perspective.
There are few studies of yield variability (only those with large datasets), but precision yield data opens up the possibility of modeling within-field variability, as well as average yield.

In this paper we ask:
  1. How does crop yield change with distance from the edge of field?
  2. Does this depend on type of field edge? 
  3. Is there an intermediate distance where yield is maximized or variance is minimized?
To our knowledge, no other study has addressed the effect of field boundaries on productivity using precision yield, making this study highly novel.

# Methods

## Data collection

Precision yield data were collected directly from farmers across Alberta.
Farmers were solicited for yield data through local agronomists, and we received `r nrow(datSource)` field-years of data from `r length(unique(datSource$grower))` growers across a total of `r length(unique(datSource$year))` years (`r min(unique(datSource$year))`-`r max(unique(datSource$year))`).
We converted raw data to a standard csv format using Ag Leader SMS.
`r round(100*sum(grepl('(Wheat|Canola|Peas)',datSource$crop))/nrow(datSource))`% of the crop types where either wheat (_Triticum aestivum_), canola (_Brassica napus_), or peas (_Pisum sativum_), three of the most common crops in rotation in Alberta.
The remaining crop types had low replication, so we constrained our analysis to only field-years containing wheat (`r sum(datSourceFinal$crop=='Wheat')`), canola (`r sum(datSourceFinal$crop=='Canola')`), or peas (`r sum(datSourceFinal$crop=='Peas')`), for a total of `r nrow(datSourceFinal)` field-years of data.
Individual fields contained between `r min(yearsPerField)` and `r max(yearsPerField)` years of data (mean: `r round(mean(yearsPerField),1)`), containing a total of `r round(sum(datSourceFinal$npoints)/1e6,1)` million data points.
  
Yield data was collected in rectangles of the same length as the data interval (distance = combine ground speed $\times$ interval, typically 1 second) and the same width as the combine header (5-7 m, adjusted to account for overlap with adjacent swaths).
We extracted the size of each polygon (m$^2$), dry yield (tonnes), and the spatial location, and the sequence of collection (1 - end of harvest)
Because of the large number of yield rectangles per field (30-800 thousand), we used the centroid of each polygon as its location, treating areal data as point data
Seeding and application rates were constant across fields, so we did not consider inputs in our analysis
We used dry yield (tonnes of seed/hectare minus recorded crop moisture) as our measure of crop yield
Precision yield data can be highly variable and is prone to extreme outliers (both positive and negative), especially when combine ground speeds are low and at the beginning of rows
Therefore, we filtered data that lay outside the 95th percentiles of yield within each field, values less than or equal to zero, and values outside of the 95th percentiles of ground speed.
Due to the large number of data at each field, we sub-sampled to 50,000 data points per field to reduce computation time.

Field boundaries were automatically digitized using buffers from the yield data locations, then manually checked using satellite imagery from Google Earth and classified land cover data from AAFC. 
Crop boundaries are flexible, and often change yearly depending on planting and emergence conditions (e.g. flooding during some years).
Ephemeral wetlands are flooded during some years, but consist mainly of grasses during dry years, and grass boundaries can change if fields are used for as haying or pasture during crop rotation.
This makes accurate and consistent classification of field boundaries difficult.
We defined the following general categories for field boundaries:
    1. Standard: grassy field edge, staging yard, or road right-of-way (grassy strip typically 5-10m wide) 
    2. Wetland: permanent wetland; borders are largely unchanged from year-to-year
    3. Shelterbelt: permanent windbreaks, shelterbelts, remnant forests, or shrublands
    4. Other crop: annual crop or pasture with little or no visible boundary between planted areas
    5. Bare: unplanted, fallow, flooded area, temporary wetland (only present for a single season), staging yard, oil and gas equipment, or road without a planted boundary
    6. Grassland: permanent seminatural grassland or pasture (not in rotation)
  
  
<!-- STANDARD -->
<!-- WETLAND -->
<!-- SHELTERBELT -->
<!-- OTHERCROP -->
<!-- BARE -->
<!-- GRASSLAND -->

## Analysis

Yield data from each field contains both random and systematic errors that must be modeled in order to reveal underlying changes in yield.
We fit an additive model of the effect of boundary distance on crop yield while accounting for within-field spatial variation and temporal variation in the data.
Crop yield can vary within a field due to soil conditions, moisture, seeding rates, herbicide application, and previous agricultural practices.      <!-- - such as strip farming -->
Ground speed is extremely important to yield monitor accuracy [@arslan2002], with low ground speed registering higher yields.
Sensor calibration can reduce combine-level bias (such as a combine recording consistently higher/lower yields across fields), this does not address sensor drift that occurs over time.
This may be caused by sensors accumulating debris during harvest (especially in canola, pers. comm. Trent Clark), leading to changes in accuracy and bias over time.
To model this, we fit the following model to each field-year of data:
  
  \begin{equation}
  \begin{split}
  \sqrt{yield} \sim & Normal (\mu, \sigma)\\
  \mu = & Intercept + log(\text{Polygon Size}) + f(\text{Edge Distance}, b=12)_i + \\
   & f(\text{Easting}, \text{Northing}, b=60) + f(\text{Sequence}, b=60) \\
  log(\sigma) =  & Intercept + log(\text{Polygon Size}) + f(\text{Edge Distance}, b=12)_i + \\
   & f(\text{Easting}, \text{Northing}, b=60) + f(\text{Sequence}, b=60) \\
  \end{split}
  \end{equation}
  
  - where:
  1. Polygon Size = distance traveled $\times$ width of header bar ($m^2$)
  2. Edge Distance = distance from field edge type _i_ (m)
  3. Easting, Northing = distance from centre of field (m)
  4. Sequence = order of harvest within field (1--N points)
  5. f(x,b) = penalized thin-plate regression spline, where _x_ is the predictor and _b_ is the number of basis dimensions
  
In addition to modeling edge effects (our variable of interest), this model also accounts for a) differences in harvested area, b) within-field spatial variation not related to edges, and d) shifts in combine accuracy during harvest.
Spatial or temporal variation can be modelled using a Gaussian Process Model (e.g. Kriging, SPDE Approximations) but this was computationally unfeasible with 50,000 data points per field.
Penalized splines offer a compromise, as they account for nonlinear ``wiggly" relationships in the same way as Gaussian processes but using a reduced number of dimensions and computation time.
The number of basis dimensions was checked with the _gam.check_ function from _mgcv_.
The relationship between polygon size and yield was modeled with a log-linear relationship with a single slope term, as this closely matched smoothed versions.
Because polygon size is not intuitive, we converted it into ground speed by regressing speed on distance traveled per polygon, then using this to back-calculate the ground speed for a given polygon size (given a fixed width of header). 
All models were fit in _R_ using the _mgcv_ library [version `r packageVersion('mgcv')`, @wood2017], and figures were created with _ggplot2_ and _ggpubr_ [versions `r packageVersion('ggplot2')`, @wickham2016; and `r packageVersion('ggpubr')`, @kassambara2020].
  
Despite the use of spatial and temporal smoothers, the residuals in most of the models displayed a large amount of spatial and temporal autocorrelation.
_Not really sure how we can get around this. In practice, this means that SEs for all coefficients are too small (i.e. we gathered 1000 points, but because they're spatially related, it's only equivalent to 100 points)._

<!-- - This is extremely common in precision yield data, but  -->

To consider results from all field-level models together, we fit models independent of each other and fit an "overall" smoother as averages of the field-level smoothers.
However, this does not account for uncertainty in the field-level smoothers, so we used an approach similar to bootstrapping of hierarchical mixed effects models:
  1. Extract single posterior sample (_rnorm_ in R) of smoother parameters from each field-level model using coefficient estimates and standard error
  2. Use posterior sample to create a new smoother from each field
  3. Fit new model of new smoothers from all fields, and save this "meta-smoother"
  4. Repeat 1000 times, and calculate coverage intervals (5-95% percentiles) on saved meta-smoothers
This gives coverage intervals (CIs) for the "average" smoother while accounting for field-level variability, and is conceptually similar to a meta-analysis.
Spatial variability was not averaged between fields because differences in field geometry make it impossible to compare fields.

# Results

## Field-level example

The filtered data from each field still contained a large amount of variation, but the non-stationary additive models were able to reveal underlying yield patterns.
To illustrate this, we show the results from a single wheat field, where we show the relative impact of ground speed, harvest sequence, boundary distance, and spatial variation on both yield mean and yield SD ("patchiness").
Figure \@ref(fig:rawData) shows the raw data collected from a single field, demonstrating a large amount of variation even among the filtered data.
Combine ground speed had a large effect on both yield mean and SD, and there was also a strong effect of harvest sequence on yield mean and SD (Figure \@ref(fig:orderSmooths).
Yield mean and SD tended to decrease with distance from field boundaries, but there were no consistent differences between boundary types (Figure \@ref(fig:distSmooths).
Finally, the random spatial smoothers in Figure \@ref(fig:spatialSmooths) show that yield mean and SD systematically vary within fields, likely due to moisture, elevation, or soil conditions (Figure \@ref(fig:spatialSmooths).


```{r rawData, echo=FALSE, fig.cap='Example output from a single field.', out.width='75%'}  
  include_graphics('../Figures/ExamplePlots/rawData.png',dpi=NA)
```

```{r orderSmooths, echo=FALSE, fig.cap='Ground speed and harvest sequence (random temporal variation) smoothers from a single field.', out.width='100%'}  
  include_graphics('../Figures/ExamplePlots/orderSmooths.png',dpi=NA)
```

```{r distSmooths, echo=FALSE, fig.cap='Distance smoothers from a single field.', out.width='100%'}  
  include_graphics('../Figures/ExamplePlots/distSmooths.png',dpi=NA)
```

```{r spatialSmooths, echo=FALSE, fig.cap='Spatial (random spatial variation) smoothers from a single field.', out.width='100%'}  
  include_graphics('../Figures/ExamplePlots/spatialSmooths.png',dpi=NA)
```

## Overall results

Across all fields, Standard (grassy border) field boundaries were the most common boundary type, followed by Shelterbelts and Other Crops (Figure \@ref(fig:boundaryTypes)).
<!-- Not sure if we should talk about this. Not very many fields from southern regions, so it's hard to compare. Perhaps mention in Discussion -->

```{r boundaryTypes, echo=FALSE, fig.cap='Percentage of field boundaries across sampled fields.', out.width='100%'}
bLengths %>% 
  mutate(croptype=datSourceFinal$crop) %>% 
  mutate(location=ifelse(grepl('(Alvin|Dean)',filename),'Southern Alberta','Central Alberta')) %>%
  group_by(location) %>% mutate(nFields=length(unique(filename))) %>% ungroup() %>% 
  mutate(location=paste0(location,' (N field-years = ',nFields,')')) %>%
  select(filename,croptype,location,contains('prop_')) %>% 
  pivot_longer(contains('prop_')) %>% 
  mutate(name=gsub('prop_','',name),value=value*100) %>% na.omit() %>%
  mutate(name=factor(name,labels=c('Bare','Grassland','Other\nCrop','Shelterbelt','Standard','Wetland'))) %>% 
  ggplot(aes(x=name,y=value,fill=croptype))+geom_boxplot()+
  facet_wrap(~location,ncol=1) +
  labs(y='Percentage of field boundary',fill='Crop')+
  scale_fill_manual(values=c('grey50','grey80','white'))+
  theme(axis.title.x = element_blank(),legend.position = 'bottom')

# bLengthSummary %>% #Table version
#   kable(.,format='latex',caption='Mean and SD of proportion of boundary types across all fields, along with the number of fields bordered by at least some of the boundary type.',col.names = c('Type','Mean','SD','Number of Fields'),digits = c(1,4,4,1),escape = FALSE)

```

### Canola fields

Overall, there was a strong negative effect of combine ground speed on both the average and variability of canola yield.
At the field level, both yield average and yield variability (SD of yield) of yield were extremely spatially (average p-values: `r with(canolaMods,formatC(meanP[Smoother=='s(E,N)']))`, `r with(canolaMods,formatC(meanP[Smoother=='s.1(E,N)'],3))`) and temporally dependent (`r with(canolaMods,formatC(meanP[Smoother=='s(r)'],3))`, `r with(canolaMods,formatC(meanP[Smoother=='s.1(r)'],3))`), meaning that average and variability changed with location in the field, as well as sequentially during the harvest.
However, there was no difference in average or variability with harvest sequence when all fields were considered, meaning that combines did not appear to distort yield data from start to finish in any systematic way.

Average canola yield tended to increase with distance from Standard and Other Crop boundaries, leveling off at about 25 m (Figure \@ref(fig:canolaPlot) top row, Other crop and Standard panels); yield was approximately 0.1 T/ha (1.5 bu/ac) lower at the edge for both of these boundary types.
Interestingly, Shelterbelts were well-represented in the data (Figure \@ref(fig:boundaryTypes)) but the negative edge effect was not strong (Figure \@ref(fig:canolaPlot) top row, Shelterbelt panel), indicating that they may provide better micro-climates for crops located near them.
Other boundary types were less common in the data and had correspondingly weaker effects on mean yield, but all showed a small negative edge effect.
Yield variability tended to decrease with distance from the edge of the field, indicating that edge effects contribute to yield "patchiness" as well as averages.
At Standard, Bare, and Wetland field boundaries, variability decreased until about 100 m, after which variability was constant, while the pattern was less consistent in Grassland, Other Crop, and Shelterbelt. 

```{r canolaPlot, echo=FALSE, fig.cap='Field boundary effect on canola yield, accounting for the effect of combine speed, spatial variation, and harvest sequence. Upper panel represents mean yield, while the lower panel represents yield variation (i.e. "patchiness").', out.width='100%'}  
  include_graphics('../Figures/ModelSummary3a_canola.png',dpi=NA)
```

### Wheat fields

Similar to canola, there was a strong negative effect of ground speed on both yield and variability of wheat yield (Figure \@ref(fig:wheatPlotSpeed), left panels).
At the field level, both yield average and yield variability (SD of yield) of yield were spatially (average p-values: `r with(wheatMods,formatC(meanP[Smoother=='s(E,N)']))`, `r with(wheatMods,formatC(meanP[Smoother=='s.1(E,N)'],3))`) and temporally dependent (`r with(wheatMods,formatC(meanP[Smoother=='s(r)'],3))`, `r with(wheatMods,formatC(meanP[Smoother=='s.1(r)'],3))`), but harvest sequence did not distort the average or SD of wheat yield in a systematic way (Figure \@ref(fig:wheatPlotSpeed), right panel).

Average wheat yield increased slightly with distance from the field boundary, but this was much more variable than the patterns seen in canola yield (Figure \@ref(fig:wheatPlot)).
There was also a slight increase in variability away from the field boundary, at least for Standard and Other Crop boundaries, but this was inconsistent among other boundary types. 

```{r wheatPlot, echo=FALSE, fig.cap='Field boundary effect on canola yield, accounting for the effect of combine speed, spatial variation, and harvest sequence. Upper panel represents mean yield, while the lower panel represents yield variation (i.e. "patchiness").', out.width='100%'}  
  include_graphics('../Figures/ModelSummary3a_wheat.png',dpi=NA)
```

### Pea fields

At the field level, both yield average and yield variability (SD of yield) of yield were spatially (average p-values: `r with(peaMods,formatC(meanP[Smoother=='s(E,N)']))`, `r with(peaMods,formatC(meanP[Smoother=='s.1(E,N)'],3))`) and temporally dependent (`r with(peaMods,formatC(meanP[Smoother=='s(r)'],3))`, `r with(peaMods,formatC(meanP[Smoother=='s.1(r)'],3))`), 
There was a strong negative effect of ground speed on yield and variability of peas (Figure \@ref(fig:peasPlotSpeed)), but harvest sequence did not distort the average or SD of wheat yield in a systematic way (Figure \@ref(fig:wheatPlotSpeed), right panel).

Average pea yields increased with distance from Shelterbelt, Standard, and Wetland field boundaries.
Interestingly, the reduction at the edge was slightly higher for Wetlands, but yield increased with distance more quickly, i.e. yields were higher at distance for Wetlands.
Variability decreased with distance from Grassland and Standard boundaries

```{r peaPlot, echo=FALSE, fig.cap='Field boundary effect on pea yield, accounting for the effect of combine speed, spatial variation, and harvest sequence. Upper panel represents mean yield, while the lower panel represents yield variation (i.e. "patchiness").', out.width='100%'}  
  include_graphics('../Figures/ModelSummary3a_peas.png',dpi=NA)
```

# Discussion

At the level of individual fields, both average and SD of yield varied with distance from the field boundary.
Both metrics also varied with ground speed and harvest sequence, and there were strong spatial relationships within each field, likely related to underlying soil or moisture conditions.
Yield tended to increase with distance from field boundaries before plateauing, but there was little evidence of intermediate boosts in yield, meaning that ecosystem services likely increased or did not vary with distance from field boundaries (Scenario 2, Figure \@ref(fig:hypotheses)).
Some crops displayed a larger decrease in yield next to field boundaries; for example, pea yield directly adjacent to Wetland was lower overall, but increased with distance more than other crop types, indicating that Wetlands may locally decrease pea yields but are beneficial to the crop in general.
Canola yields next to Other Crops had a reduced edge effect compared to Standard field boundaries, indicating that Other Crops may provide a more consistent microclimate for canola than grassy field boundaries.
However, the difference between boundary types tended to be both small and variable, especially for wheat.
<!-- For example, average canola yield was about 0.5 T/ha lower close to Standard field edges, and yield SD was about 0.3 T/ha SD higher. -->


Why did we find few consistent effects of boundary type on crop yield?
We consider a few potential reasons for this below:
1. Landscape influence
2. Boundary variables
3. Ecosystem disservices
4. Yearly/location variation
5. Lack of pest pressure/pollination deficit

Our analysis only examined boundary types, without considering the landscape context that fields were embedded in.
Some studies show the influence of landscape composition at larger spatial scales (e.g. Lan's paper) which could be particularly important when beneficial arthropods are highly mobile (e.g. bumblebee foraging) or disperse very broadly [@oberg2007].
There could also be interactions between landscape composition at different scales [@motzke2016; @robinson2021], but this is not well-studied.
Landscape complexity [@fahrig2011] and connectivity are also associated with higher abundance of beneficial arthropods (Paul's new paper + others).
This means that field boundaries such as wetlands or shelterbelts may only be helpful if connected to a larger network of non-crop habitat [but see @fahrig2019].
Our definitions of boundary type were also (necessarily) loose, as we used satellite imagery to manually classify them.
However, it may be that other boundary traits, such as size or plant species composition, are more important for spillover of ecosystems services into fields.
For example, larger [@lecq2018; @stasiov2020] or more functionally diverse [@bonifacio2011; @boughey2011] hedgerows tend to support more biodiversity than smaller hedgerows, and some studies have shown that leaf litter and soil compaction matters to predatory beetle communities [@sutter2018b].
These fine-scale boundary characteristics were not measured in our study, but could be used as variables in more biologically-meaningful classifications of field boundaries.

Our first scenario (Scenario 1, Figure \@ref(fig:hypotheses)) assumes that beneficial organisms disperse from boundaries into the field, and had a generally positive effect on crop yield.
However, field boundaries may not have a positive effect if a) pests (ecosystem dis-services) also disperse along with beneficials, b) if beneficials do not disperse from the boundary environment, or if c) the effect of beneficial organisms is small.
Ecosystem disservices such as pests and weeds can also disperse from field boundaries, which may negate any positive effect of ecosystem services [@zhang2007].
@gray2014 showed that remnant forest fragments do not provide significant pest control services , but also do not depress yield.
However, this is still poorly studied, and parsing out services from disservices is impossible using crop yield data _alone_.
Ecosystem services from field boundaries may be limited if beneficial organisms stay in field boundaries, or disperse at wider spatial scales [@oberg2007; @zamorano2020, but see @robinson2021].
Finally, pest pressure or pollination deficit may be low enough that ecosystem service provision does not significantly change yield.
Canola is largely self-pollinating [at least in hybrid canola varieties, @lindstrom2016] and wheat is wind-pollinated, meaning that slight increases in pollination services may not change yields significantly in either crop [@woodcock2016].
Pests are also limited by growers' application of insecticides (seed-treated or on the crop directly), and insect pest outbreaks tend to be temporally and spatially spotty.

Since our sampling represents a limited amount of spatial and temporal coverage, there could be additional confounding variables that obscure signals of yield.
Most fields were located in Central Alberta [Dry Mixedwood region, @ABRegions2006], where boundaries contained a higher proportion of Shelterbelts (Figure \@ref(fig:boundaryTypes)), but differences from Southern AB (Foothills Fescue and Mixedgrass region) may be confounding the signal.
Between-year effects may be important, especially during dry years [@kort1988], but this was not considered in our analysis.
Future work could examine whether boundaries have differing effects during hot or cool years.
  
We used harvest time as smoothed variable to deal with temporal autocorrelation in the data, but this is a crude way to deal with this.
This is because in-field combine driving patterns _almost always_ induce correlation between spatial and temporal measurements (e.g. northern section of the field was harvested before the southern section), meaning that temporal and spatial random effects are difficult to separate.
There are few solutions to this using harvest data as-is, other than to ignore temporal random effects entirely, thereby constraining all random variation to be spatial.
However, it is possible to remove correlation between spatial and temporal measurements by using specially designed harvest patterns within a field (harvesting alternating strips sequentially across the field, then harvesting the remaining strips on a second pass).
Future studies could use this to estimate drift in combine sensor measurements over time.
  

# Author Contributions

SVJR and PG conceived of the project.
SVJR collected data, conducted analysis, and wrote the manuscript.

# Acknowledgements

We thank Trent Clark, Dean Hubbard, Alvin French, and Kristina Polziehn for providing yield data for us, and providing insight on their yield data. 
We also thank Autumn Barnes and Keith Gabert of the Canola Council of Canada, and Laurel Thompson and JP Pettyjohn of Lakeland College for connecting us with farmers and agronomists. 
Funding for this research was provided by Ducks Unlimited Canada's Institute for Wetland and Waterfowl Research, the Alberta Canola Producers Commission, Manitoba Canola Growers Association, SaskCanola, the Alberta Biodiversity Monitoring Institute, and the Alberta Conservation Association.

# References {-}

<div id="refs"></div>

```{r child = 'supplemental.Rmd'}
```

